---
title: "League of Legends - Data Modeling"
output: html_notebook
---

#### Disclaimer
** This notebook should be executed after running Process.Rmd

## 1. Data Preparation
```{r}
# Load Important Library
library(caret)
library(dplyr)
library(rpart)

# We should load processed_matches.csv that is generated by Process.Rmd.
setwd('/Users/davidleonardi/Projects/KE5107/CA_1/KE5107_LeagueofLegends')
matches <- read.csv("processed_matches.csv", na.strings=c(".", "NA", "", "?"), strip.white=TRUE, encoding="UTF-8")

# Set seed value to make sure our test result is repeatable.
seed_value = 42
set.seed(seed_value)

# Set our target variable as factor.
matches$bResult <- as.factor(make.names(matches$bResult))
```

## 2. Modeling

### 2.1. Before game start

```{r}
# We use 10-folds cross validation.
train_control <- trainControl(method="cv", number=10)

input <- c("rWinEfficiency", "bWinEfficiency",
           "isBluePreferredLineup", "isRedPreferredLineup", 
           "isBluePreferredChamps", "isRedPreferredChamps")

target <- "bResult"

data <- na.exclude(matches[, c(input, target)])

# split data to 85% training and 15% testing data
sample_size = floor(0.85 * nrow(data))
training_index = sample(seq_len(nrow(data)), size=sample_size)
training_data = data[training_index,]
testing_data = data[-training_index,]
```

##### 2.1.1. Neural Network
Run grid search for neural network hyperparameters
```{r}
tunegrid <- expand.grid(.size=c(2, 5, 6, 8, 10, 20), .decay=c(0.01))
```
Train the model.
```{r}
model <- caret::train(bResult~., data=training_data, trControl=train_control, 
               method = "nnet", tuneGrid=tunegrid, metric = "Accuracy", linout = FALSE)   

# summarize results
print(model)
```

Run prediction on training data using neural network model.
```{r}
prediction_train <- predict(model, training_data)

# confusion matrix based on training data
confusionMatrix(prediction_train, training_data$bResult)
```

Then run prediction on testing data.
```{r}
# run prediction on testing data
prediction_test <- predict(model, testing_data)

# confusion matrix based on testing data
confusionMatrix(prediction_test, testing_data$bResult)
```

##### 2.1.2. Decision Tree

Run grid search for decision tree hyperparameters.
```{r}
tunegrid <- expand.grid(.cp = c(0.01, 0.05))
model_control <- rpart.control(minsplit = 20, minbucket = 7, maxdepth = 3)
```

Train the model.
```{r}
model <- caret::train(bResult~., data=training_data, method = "rpart", tuneGrid = tunegrid, 
                      trControl=train_control, control = model_control, metric = "Accuracy")

# summarize results
print(model)
```

Run prediction on training data using neural network model.
```{r}
prediction_train <- predict(model, training_data)

# confusion matrix based on training data
confusionMatrix(prediction_train, training_data$bResult)
```
Then run prediction on testing data.
```{r}
# run prediction on testing data
prediction_test <- predict(model, testing_data)

# confusion matrix based on testing data
confusionMatrix(prediction_test, testing_data$bResult)
```

##### 2.1.3. Random Forest

Train the model.
```{r}
tunegrid <- expand.grid(.mtry=2)

model <- train(bResult~.,  data=training_data,  tuneGrid=tunegrid, ntree=250, trControl=train_control, 
               metric="Accuracy", method = "rf")

print(model)
```

Run prediction on training data using neural network model.
```{r}
prediction_train <- predict(model, training_data)

# confusion matrix based on training data
confusionMatrix(prediction_train, training_data$bResult)
```
Then run prediction on testing data.
```{r}
# run prediction on testing data
prediction_test <- predict(model, testing_data)

# confusion matrix based on testing data
confusionMatrix(prediction_test, testing_data$bResult)
```

##### 2.1.4. Logistic Regression
Train the model.
```{r}
model <- train(bResult~., data=training_data, trControl=train_control, method="glm", family="binomial")

print(model)
```

Run prediction on training data using neural network model.
```{r}
prediction_train <- predict(model, training_data)

# confusion matrix based on training data
confusionMatrix(prediction_train, training_data$bResult)
```

Then run prediction on testing data.
```{r}
# run prediction on testing data
prediction_test <- predict(model, testing_data)

# confusion matrix based on testing data
confusionMatrix(prediction_test, testing_data$bResult)
```

##### 2.1.5. Support Vector Machine
```{r}
tunegrid <- expand.grid(sigma = c(0.005), C = c(0.5))

model <- train(bResult~.,  data=training_data,  trControl=train_control, method="svmRadial",
               preProc=c("center", "scale"), metric="Accuracy", tuneGrid=tunegrid)

# summarize results
print(model)
```

Run prediction on training data using neural network model.
```{r}
# run prediction on training data
prediction_train <- predict(model, training_data)

# confusion matrix based on training data
confusionMatrix(prediction_train, training_data$bResult)

```

Then run prediction on testing data.
```{r}
# run prediction on testing data
prediction_test <- predict(model, testing_data)

# confusion matrix based on testing data
confusionMatrix(prediction_test, testing_data$bResult)
```

##### 2.1.6. Extreme Gradient Boosting
```{r}
tunegrid <- expand.grid(
  "eta" = c(0.3), 
  "max_depth" = c(6), 
  "gamma" = c(0),
  "subsample" = c(0.5, 0.9), 
  "colsample_bytree" = c(0.8),
  "nrounds" = c(50),
  "min_child_weight" = c(0, 1)
)

model <- train(bResult~., data=training_data, trControl=train_control, method = "xgbTree",
               metric = "Accuracy", tuneGrid=tunegrid)

# summarize results
print(model)
```

Run prediction on training data using neural network model.
```{r}
# run prediction on training data
prediction_train <- predict(model, training_data)

# confusion matrix based on training data
confusionMatrix(prediction_train, training_data$bResult)

```

Then run prediction on testing data.
```{r}
# run prediction on testing data
prediction_test <- predict(model, testing_data)

# confusion matrix based on testing data
confusionMatrix(prediction_test, testing_data$bResult)
```


### 2.2. Five (5) Minutes after the game start

```{r}
# We use 10-folds cross validation.
train_control <- trainControl(method="cv", number=10)

input <- c("rWinEfficiency", "bWinEfficiency",
           "bTowers5Mins", "rTowers5Mins", 
           "bDragons5Mins", "rDragons5Mins", 
           "bKills5Mins", "rKills5Mins",
           "goldblue5Mins", "goldred5Mins",
           "isBluePreferredLineup", "isRedPreferredLineup", 
           "isBluePreferredChamps", "isRedPreferredChamps")

target <- "bResult"

data <- matches[, c(input, target)]

# split data to 85% training and 15% testing data
sample_size = floor(0.85 * nrow(data))
training_index = sample(seq_len(nrow(data)), size=sample_size)
training_data = data[training_index,]
testing_data = data[-training_index,]
```

##### 2.2.1. Neural Network
Run grid search for neural network hyperparameters
```{r}
tunegrid <- expand.grid(.size=c(2, 5, 6, 8, 10), .decay=c(0.01))
```
Train the model.
```{r}
model <- caret::train(bResult~., data=training_data, trControl=train_control, 
               method = "nnet", tuneGrid=tunegrid, metric = "Accuracy", linout = FALSE)
```

```{r}
# summarize results
print(model)
```

Run prediction on training data using neural network model.
```{r}
# run prediction on training data
prediction_train <- predict(model, training_data)

# confusion matrix based on training data
confusionMatrix(prediction_train, training_data$bResult)

```

Then run prediction on testing data.
```{r}
# run prediction on testing data
prediction_test <- predict(model, testing_data)

# confusion matrix based on testing data
confusionMatrix(prediction_test, testing_data$bResult)
```

##### 2.2.2. Decision Tree

Run grid search for decision tree hyperparameters.
```{r}
tunegrid <- expand.grid(.cp = c(0.01, 0.05))
model_control <- rpart.control(minsplit = 20, minbucket = 7, maxdepth = 3)
```

Train the model.
```{r}
model <- caret::train(bResult~., data=training_data, method = "rpart", tuneGrid = tunegrid, 
                      trControl=train_control, control = model_control, metric = "Accuracy")

# summarize results
print(model)
```

Run prediction on training data using neural network model.
```{r}
prediction_train <- predict(model, training_data)

# confusion matrix based on training data
confusionMatrix(prediction_train, training_data$bResult)
```
Then run prediction on testing data.
```{r}
# run prediction on testing data
prediction_test <- predict(model, testing_data)

# confusion matrix based on testing data
confusionMatrix(prediction_test, testing_data$bResult)
```

##### 2.2.3. Random Forest

Train the model.
```{r}
tunegrid <- expand.grid(.mtry=4)

model <- train(bResult~.,  data=training_data,  tuneGrid=tunegrid, ntree=2000, trControl=train_control, 
               metric="Accuracy", method = "rf")
```

Summary of RF model
```{r}
print(model)
```

Run prediction on training data using neural network model.
```{r}
prediction_train <- predict(model, training_data)

# confusion matrix based on training data
confusionMatrix(prediction_train, training_data$bResult)
```
Then run prediction on testing data.
```{r}
# run prediction on testing data
prediction_test <- predict(model, testing_data)

# confusion matrix based on testing data
confusionMatrix(prediction_test, testing_data$bResult)
```

##### 2.2.4. Logistic Regression

Train the model.
```{r}
model <- train(bResult~., data=training_data, trControl=train_control, method="glm", family="binomial")
```

Summary of RF model
```{r}
print(model)
```

Run prediction on training data using neural network model.
```{r}
prediction_train <- predict(model, training_data)

# confusion matrix based on training data
confusionMatrix(prediction_train, training_data$bResult)
```

Then run prediction on testing data.
```{r}
# run prediction on testing data
prediction_test <- predict(model, testing_data)

# confusion matrix based on testing data
confusionMatrix(prediction_test, testing_data$bResult)
```

##### 2.2.5. Support Vector Machine
```{r}
tunegrid <- expand.grid(sigma = c(0.005), C = c(0.5))

model <- train(bResult~.,  data=training_data,  trControl=train_control, method="svmRadial",
               preProc=c("center", "scale"), metric="Accuracy", tuneGrid=tunegrid)

# summarize results
print(model)
```

Run prediction on training data using neural network model.
```{r}
# run prediction on training data
prediction_train <- predict(model, training_data)

# confusion matrix based on training data
confusionMatrix(prediction_train, training_data$bResult)

```

Then run prediction on testing data.
```{r}
# run prediction on testing data
prediction_test <- predict(model, testing_data)

# confusion matrix based on testing data
confusionMatrix(prediction_test, testing_data$bResult)
```

##### 2.2.6. Extreme Gradient Boosting
```{r}
tunegrid <- expand.grid(
  "eta" = c(0.3), 
  "max_depth" = c(6), 
  "gamma" = c(0),
  "subsample" = c(0.5, 0.9), 
  "colsample_bytree" = c(0.8),
  "nrounds" = c(50),
  "min_child_weight" = c(0, 1)
)

model <- train(bResult~., data=training_data, trControl=train_control, method = "xgbTree",
               metric = "Accuracy", tuneGrid=tunegrid)

# summarize results
print(model)
```

Run prediction on training data using neural network model.
```{r}
# run prediction on training data
prediction_train <- predict(model, training_data)

# confusion matrix based on training data
confusionMatrix(prediction_train, training_data$bResult)

```

Then run prediction on testing data.
```{r}
# run prediction on testing data
prediction_test <- predict(model, testing_data)

# confusion matrix based on testing data
confusionMatrix(prediction_test, testing_data$bResult)
```


### 2.3. Ten (10) Minutes after the game start

```{r}
# We use 10-folds cross validation.
train_control <- trainControl(method="cv", number=10)

input <- c("rWinEfficiency", "bWinEfficiency",
           "bTowers10Mins", "rTowers10Mins", 
           "rInhibs10Mins", 
           "bDragons10Mins", "rDragons10Mins", 
           "bKills10Mins", "rKills10Mins",
           "goldblue10Mins", "goldred10Mins",
           "isBluePreferredLineup", "isRedPreferredLineup", 
           "isBluePreferredChamps", "isRedPreferredChamps")

target <- "bResult"

data <- matches[, c(input, target)]

# split data to 85% training and 15% testing data
sample_size = floor(0.85 * nrow(data))
training_index = sample(seq_len(nrow(data)), size=sample_size)
training_data = data[training_index,]
testing_data = data[-training_index,]
```

##### 2.3.1. Neural Network
Run grid search for neural network hyperparameters
```{r}
tunegrid <- expand.grid(.size=c(2, 5, 6, 8, 10), .decay=c(0.01))
```
Train the model.
```{r}
model <- caret::train(bResult~., data=training_data, trControl=train_control, 
               method = "nnet", tuneGrid=tunegrid, metric = "Accuracy", linout = FALSE)
```

```{r}
# summarize results
print(model)
```

Run prediction on training data using neural network model.
```{r}
# run prediction on training data
prediction_train <- predict(model, training_data)

# confusion matrix based on training data
confusionMatrix(prediction_train, training_data$bResult)

```

Then run prediction on testing data.
```{r}
# run prediction on testing data
prediction_test <- predict(model, testing_data)

# confusion matrix based on testing data
confusionMatrix(prediction_test, testing_data$bResult)
```

##### 2.3.2. Decision Tree

Run grid search for decision tree hyperparameters.
```{r}
tunegrid <- expand.grid(.cp = c(0.01, 0.05))
model_control <- rpart.control(minsplit = 20, minbucket = 7, maxdepth = 3)
```

Train the model.
```{r}
model <- caret::train(bResult~., data=training_data, method = "rpart", tuneGrid = tunegrid, 
                      trControl=train_control, control = model_control, metric = "Accuracy")

# summarize results
print(model)
```

Run prediction on training data using neural network model.
```{r}
prediction_train <- predict(model, training_data)

# confusion matrix based on training data
confusionMatrix(prediction_train, training_data$bResult)
```
Then run prediction on testing data.
```{r}
# run prediction on testing data
prediction_test <- predict(model, testing_data)

# confusion matrix based on testing data
confusionMatrix(prediction_test, testing_data$bResult)
```

##### 2.3.3. Random Forest

Train the model.
```{r}
tunegrid <- expand.grid(.mtry=4)

model <- train(bResult~.,  data=training_data,  tuneGrid=tunegrid, ntree=500, trControl=train_control, 
               metric="Accuracy", method = "rf")
```

Summary of RF model
```{r}
print(model)
```

Run prediction on training data using neural network model.
```{r}
prediction_train <- predict(model, training_data)

# confusion matrix based on training data
confusionMatrix(prediction_train, training_data$bResult)
```
Then run prediction on testing data.
```{r}
# run prediction on testing data
prediction_test <- predict(model, testing_data)

# confusion matrix based on testing data
confusionMatrix(prediction_test, testing_data$bResult)
```

##### 2.3.4. Logistic Regression

Train the model.
```{r}
model <- train(bResult~., data=training_data, trControl=train_control, method="glm", family="binomial")
```

Summary of RF model
```{r}
print(model)
```

Run prediction on training data using neural network model.
```{r}
prediction_train <- predict(model, training_data)

# confusion matrix based on training data
confusionMatrix(prediction_train, training_data$bResult)
```

Then run prediction on testing data.
```{r}
# run prediction on testing data
prediction_test <- predict(model, testing_data)

# confusion matrix based on testing data
confusionMatrix(prediction_test, testing_data$bResult)
```

##### 2.3.5. Support Vector Machine
```{r}
tunegrid <- expand.grid(sigma = c(0.005), C = c(0.5))

model <- train(bResult~.,  data=training_data,  trControl=train_control, method="svmRadial",
               preProc=c("center", "scale"), metric="Accuracy", tuneGrid=tunegrid)

# summarize results
print(model)
```

Run prediction on training data using neural network model.
```{r}
# run prediction on training data
prediction_train <- predict(model, training_data)

# confusion matrix based on training data
confusionMatrix(prediction_train, training_data$bResult)

```

Then run prediction on testing data.
```{r}
# run prediction on testing data
prediction_test <- predict(model, testing_data)

# confusion matrix based on testing data
confusionMatrix(prediction_test, testing_data$bResult)
```

##### 2.3.6. Extreme Gradient Boosting
```{r}
tunegrid <- expand.grid(
  "eta" = c(0.3), 
  "max_depth" = c(6), 
  "gamma" = c(0),
  "subsample" = c(0.5, 0.9), 
  "colsample_bytree" = c(0.8),
  "nrounds" = c(50),
  "min_child_weight" = c(0, 1)
)

model <- train(bResult~., data=training_data, trControl=train_control, method = "xgbTree",
               metric = "Accuracy", tuneGrid=tunegrid)

# summarize results
print(model)
```

Run prediction on training data using neural network model.
```{r}
# run prediction on training data
prediction_train <- predict(model, training_data)

# confusion matrix based on training data
confusionMatrix(prediction_train, training_data$bResult)

```

Then run prediction on testing data.
```{r}
# run prediction on testing data
prediction_test <- predict(model, testing_data)

# confusion matrix based on testing data
confusionMatrix(prediction_test, testing_data$bResult)
```


### 2.4. Twenty (20) Minutes after the game start

```{r}
# We use 10-folds cross validation.
train_control <- trainControl(method="cv", number=10)

input <- c("rWinEfficiency", "bWinEfficiency", 
           "bTowers20Mins", "rTowers20Mins",
           "bInhibs20Mins", "rInhibs20Mins",
           "bDragons20Mins", "rDragons20Mins",
           "bBarons20Mins",  "rBarons20Mins", 
           "bKills20Mins", "rKills20Mins",
           "goldblue20Mins", "goldred20Mins",
           "isBluePreferredLineup", "isRedPreferredLineup",  
           "isBluePreferredChamps", "isRedPreferredChamps")

target <- "bResult"

data <- na.exclude(matches[, c(input, target)])

# split data to 85% training and 15% testing data
sample_size = floor(0.85 * nrow(data))
training_index = sample(seq_len(nrow(data)), size=sample_size)
training_data = data[training_index,]
testing_data = data[-training_index,]
```

##### 2.4.1. Neural Network
Run grid search for neural network hyperparameters
```{r}
tunegrid <- expand.grid(.size=c(2, 5, 6, 8, 10), .decay=c(0.01))
```
Train the model.
```{r}
model <- caret::train(bResult~., data=training_data, trControl=train_control, 
               method = "nnet", tuneGrid=tunegrid, metric = "Accuracy", linout = FALSE)
```

```{r}
# summarize results
print(model)
```

Run prediction on training data using neural network model.
```{r}
# run prediction on training data
prediction_train <- predict(model, training_data)

# confusion matrix based on training data
confusionMatrix(prediction_train, training_data$bResult)

```

Then run prediction on testing data.
```{r}
# run prediction on testing data
prediction_test <- predict(model, testing_data)

# confusion matrix based on testing data
confusionMatrix(prediction_test, testing_data$bResult)
```

##### 2.4.2. Decision Tree

Run grid search for decision tree hyperparameters.
```{r}
tunegrid <- expand.grid(.cp = c(0.01, 0.05))
model_control <- rpart.control(minsplit = 20, minbucket = 7, maxdepth = 3)
```

Train the model.
```{r}
model <- caret::train(bResult~., data=training_data, method = "rpart", tuneGrid = tunegrid, 
                      trControl=train_control, control = model_control, metric = "Accuracy")

# summarize results
print(model)
```

Run prediction on training data using neural network model.
```{r}
prediction_train <- predict(model, training_data)

# confusion matrix based on training data
confusionMatrix(prediction_train, training_data$bResult)
```
Then run prediction on testing data.
```{r}
# run prediction on testing data
prediction_test <- predict(model, testing_data)

# confusion matrix based on testing data
confusionMatrix(prediction_test, testing_data$bResult)
```

##### 2.4.3. Random Forest

Train the model.
```{r}
tunegrid <- expand.grid(.mtry=2)

model <- train(bResult~.,  data=training_data,  tuneGrid=tunegrid, ntree=2000, trControl=train_control, 
               metric="Accuracy", method = "rf")
```

Summary of RF model
```{r}
print(model)
```

Run prediction on training data using neural network model.
```{r}
prediction_train <- predict(model, training_data)

# confusion matrix based on training data
confusionMatrix(prediction_train, training_data$bResult)
```

Then run prediction on testing data.
```{r}
# run prediction on testing data
prediction_test <- predict(model, testing_data)

# confusion matrix based on testing data
confusionMatrix(prediction_test, testing_data$bResult)
```

##### 2.4.4. Logistic Regression

Train the model.
```{r}
model <- train(bResult~., data=training_data, trControl=train_control, method="glm", family="binomial")
```

Summary of RF model
```{r}
print(model)
```

Run prediction on training data using neural network model.
```{r}
prediction_train <- predict(model, training_data)

# confusion matrix based on training data
confusionMatrix(prediction_train, training_data$bResult)
```

Then run prediction on testing data.
```{r}
# run prediction on testing data
prediction_test <- predict(model, testing_data)

# confusion matrix based on testing data
confusionMatrix(prediction_test, testing_data$bResult)
```

##### 2.4.5. Support Vector Machine
```{r}
tunegrid <- expand.grid(sigma = c(0.005), C = c(0.5))

model <- train(bResult~.,  data=training_data,  trControl=train_control, method="svmRadial",
               preProc=c("center", "scale"), metric="Accuracy", tuneGrid=tunegrid)

# summarize results
print(model)
```

Run prediction on training data using neural network model.
```{r}
# run prediction on training data
prediction_train <- predict(model, training_data)

# confusion matrix based on training data
confusionMatrix(prediction_train, training_data$bResult)

```

Then run prediction on testing data.
```{r}
# run prediction on testing data
prediction_test <- predict(model, testing_data)

# confusion matrix based on testing data
confusionMatrix(prediction_test, testing_data$bResult)
```

##### 2.4.6. Extreme Gradient Boosting
```{r}
tunegrid <- expand.grid(
  "eta" = c(0.3), 
  "max_depth" = c(6), 
  "gamma" = c(0),
  "subsample" = c(0.5, 0.9), 
  "colsample_bytree" = c(0.8),
  "nrounds" = c(50),
  "min_child_weight" = c(0, 1)
)

model <- train(bResult~., data=training_data, trControl=train_control, method = "xgbTree",
               metric = "Accuracy", tuneGrid=tunegrid)

# summarize results
print(model)
```

Run prediction on training data using neural network model.
```{r}
# run prediction on training data
prediction_train <- predict(model, training_data)

# confusion matrix based on training data
confusionMatrix(prediction_train, training_data$bResult)

```

Then run prediction on testing data.
```{r}
# run prediction on testing data
prediction_test <- predict(model, testing_data)

# confusion matrix based on testing data
confusionMatrix(prediction_test, testing_data$bResult)
```

